<%- include('../elements/header'); %>
<div class="main-content">
    <div class="main-content-inner">
        <div class="breadcrumbs ace-save-state" id="breadcrumbs">
            <ul class="breadcrumb">
                <li><i class="ace-icon fa fa-tachometer"></i>
                    <a href="<%=nodeAdminUrl%>/Dashboard">Dashboard</a>
                </li>
                <li class="active"><a href="<%=nodeAdminUrl%>/<%=controller%>/list"> Courses </a></li>
                <li class="active">Add</li>
            </ul>
        </div>

        <div class="page-content">
            <div class="page-header">
                <h1>Add New Course</h1>
            </div>

            <div class="row">
                <%- include ../elements/flash.ejs %>
                <div class="col-xs-12 col-sm-8">
                    <form id="pageForm" method="post" action="<%=nodeAdminUrl%>/<%=controller%>/add" enctype="multipart/form-data">
                      <div class="form-group">
                        <label>Title</label>
                        <input type="text" name="courseName" value="<%=data.courseName%>" class="form-control" placeholder="Course Title">
                        <span class="error"><%=errorData.courseName%></span>
                      </div>

                      <div class="form-group">
                        <label>Type</label>
                        <select name="type" class="form-control">
                          <option value="classroom" <%=data.type==='classroom'?'selected':''%>>Classroom</option>
                          <option value="elearning" <%=data.type==='elearning'?'selected':''%>>E-Learning</option>
                        </select>
                      </div>

                      <div class="form-group">
                        <label>Category</label>
                        <select name="category" class="form-control">
                          <% if (categories && categories.length > 0) { %>
                              <% categories.forEach(function(category) { %>
                                  <option value="<%=String(category._id)%>"><%=category.categoryName%></option>
                              <% }) %>
                          <% } %>
                        </select>
                      </div>

                      <div class="form-group">
                        <label>Content</label>
                        <div id="quillEditor" style="height:200px;"></div>
                        <input type="hidden" name="content" id="content" value="<%=data.content%>">
                        <span class="error"><%=errorData.content%></span>
                      </div>

                      <div class="form-group">
                        <label>Videos</label>
                        <input type="file" name="videos" multiple class="form-control">
                        <p class="help-block">Upload multiple videos OR use embedded links below</p>
                        <input type="text" name="video_links[]" class="form-control mb-1" placeholder="YouTube/Vimeo Embed URL">
                        <button type="button" class="btn btn-sm btn-secondary add-video-link">+ Add More Links</button>
                      </div>

                      <div class="form-group">
                        <label>Status</label>
                        <select name="status" class="form-control">
                          <option value="draft" <%=data.status==="draft"?"selected":""%>>Draft</option>
                          <option value="published" <%=data.status==="published"?"selected":""%>>Published</option>
                        </select>
                      </div>

                      <div class="form-group">
                        <button class="btn btn-info" type="submit">Submit</button>
                        <a href="<%=nodeAdminUrl%>/<%=controller%>/list" class="btn">Cancel</a>
                      </div>
                    </form>
                </div>
            </div>
        </div><!-- /.page-content -->
    </div>
</div>
<%- include('../elements/footer'); %>

<link href="<%=nodeSiteUrl%>/css/quill.snow.css" rel="stylesheet">
<script src="<%=nodeSiteUrl%>/js/quill.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  // Initialize Quill
  const quill = new Quill("#quillEditor", {
    theme: "snow",
    placeholder: "Write course content here..."
  });

  // If editing, load existing HTML
  const existingContent = document.getElementById("content").value;
  if (existingContent) {
    quill.root.innerHTML = existingContent;
  }

  // On submit â†’ update hidden input
  document.getElementById("pageForm").addEventListener("submit", function () {
    document.getElementById("content").value = quill.root.innerHTML;
  });

  document.addEventListener("click", (e) => {
    if(e.target.classList.contains("add-video-link")){
      e.preventDefault();
      const input = document.createElement("input");
      input.type = "text";
      input.name = "video_links[]";
      input.classList = "form-control mb-1";
      input.placeholder = "YouTube/Vimeo Embed URL";
      e.target.before(input);
    }
  });
});
</script>