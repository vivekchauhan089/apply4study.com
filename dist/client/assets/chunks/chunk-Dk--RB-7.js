import{r as i,j as e}from"./chunk-YN4sDS3B.js";import{R as L}from"./chunk-CGJver67.js";var M={};function D({userId:p,courseId:m,lessons:x=[],startLessonId:I,isOpen:y,onClose:j}){const l=i.useRef(null);i.useEffect(()=>{const t=document.createElement("div");return t.className="course-player-portal",document.body.appendChild(t),l.current=t,()=>{l.current&&document.body.removeChild(l.current),l.current=null}},[]),i.useEffect(()=>{if(!l.current)return;let t=l.current.parentElement;for(;t;){const s=getComputedStyle(t);if(s.transform&&s.transform!=="none"||s.filter&&s.filter!=="none"||s.perspective&&s.perspective!=="none"||s.willChange&&s.willChange!=="auto"){console.warn("Ancestor with transform/filter detected which can trap fixed children:",t,{transform:s.transform,filter:s.filter,perspective:s.perspective,willChange:s.willChange});break}t=t.parentElement}},[l.current]);const g=i.useRef(null),b=x.findIndex(t=>t.id===I),[n,f]=i.useState(b>=0?b:0),[r,a]=i.useState({}),[V,C]=i.useState(!1),[W,N]=i.useState(null),S=i.useRef(null),O=900,[d,G]=i.useState(x[n]?x[n]:null),v=`course_progress_${m}_${p}`,k=M.REACT_APP_API_URL;i.useEffect(()=>{let t=!0;async function s(){try{const o=await fetch(`${k}/course/progress`,{method:"POST",headers:{"Content-Type":"application/json","x-access-token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMjM0LCJ1c2VyX3R5cGVfaWQiOjAsInJvbGUiOiJndWVzdCIsImlhdCI6MTc1ODg4NDcwOCwiZXhwIjoxNzY0MDY4NzA4fQ.zWg19kpqcRf0sxKzrioWP_HzogoC5fHQPeGHTE6nZpc"},body:JSON.stringify({userId:p,courseId:m})});if(!o.ok)throw new Error(`API error ${o.status}`);const h=await o.json();if(!t)return;if(h&&h.success&&Array.isArray(h.data)){const c={};h.data.forEach(u=>{c[u.lessonId]={progress:typeof u.progress=="number"?u.progress:0,completed:!!u.completed,lastUpdated:u.lastUpdated||null}}),a(c);try{localStorage.setItem(v,JSON.stringify(c))}catch{}}else{const c=localStorage.getItem(v);c&&a(JSON.parse(c))}}catch{const h=localStorage.getItem(v);h&&a(JSON.parse(h)),N("Could not reach progress API, using local progress (offline).")}}return p&&m&&s(),()=>{t=!1}},[p,m]);const P=(t,s,o=!1)=>{S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{w(t,s,o)},O)},w=async(t,s,o=!1)=>{C(!0);const h={userId:p,courseId:m,lessonId:t,progress:s,completed:o};a(c=>({...c,[t]:{progress:s,completed:o,lastUpdated:new Date().toISOString()}}));try{const c=await fetch(`${k}/course/progress`,{method:"POST",headers:{"Content-Type":"application/json","x-access-token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMjM0LCJ1c2VyX3R5cGVfaWQiOjAsInJvbGUiOiJndWVzdCIsImlhdCI6MTc1ODg4NDcwOCwiZXhwIjoxNzY0MDY4NzA4fQ.zWg19kpqcRf0sxKzrioWP_HzogoC5fHQPeGHTE6nZpc"},body:JSON.stringify(h)});if(!c.ok)throw new Error(`Save failed: ${c.status}`);const u=await c.json();try{localStorage.setItem(v,JSON.stringify({...r,[t]:{progress:s,completed:o,lastUpdated:new Date().toISOString()}}))}catch{}return C(!1),u}catch{try{const u={...r,[t]:{progress:s,completed:o,lastUpdated:new Date().toISOString()}};localStorage.setItem(v,JSON.stringify(u)),C(!1),N("Could not save to server — progress saved locally.")}catch{C(!1),N("Could not save progress.")}}},J=()=>{const t=g.current;if(!t||!d||!t.duration)return;const s=Math.round(t.currentTime/t.duration*100),o=r[d.id]?.progress||0;s!==o&&P(d.id,s,s>=99)},_=()=>{d&&w(d.id,100,!0)},T=()=>{d&&w(d.id,100,!0)};if(!y||!l.current)return null;const R={position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.65)",zIndex:999999},A={width:"min(1100px, 96vw)",maxHeight:"90vh",overflow:"hidden",borderRadius:12,background:"#fff",boxShadow:"0 10px 30px rgba(0,0,0,0.25)",position:"relative",display:"flex",gap:16},E={flex:2,padding:16,display:"flex",flexDirection:"column",gap:12},z={flex:1,padding:16,overflowY:"auto",borderLeft:"1px solid #eee"};return L.createPortal(e.jsx("div",{style:R,onClick:j,role:"dialog","aria-modal":"true",children:e.jsxs("div",{style:A,onClick:t=>t.stopPropagation(),children:[e.jsx("button",{onClick:j,style:{position:"absolute",right:12,top:12,border:"none",background:"transparent",fontSize:20,cursor:"pointer"},"aria-label":"Close",children:"✖"}),e.jsxs("div",{style:E,children:[e.jsx("h3",{style:{margin:0},children:d?.title??"No lesson selected"}),e.jsx("div",{style:{aspectRatio:"16/9",background:"#000",borderRadius:8,overflow:"hidden"},children:d?e.jsx("video",{ref:g,src:d.src,controls:!0,style:{width:"100%",height:"100%",objectFit:"cover"},onTimeUpdate:J,onEnded:_},d.id):e.jsx("div",{style:{color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:"No lesson"})}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>{const t=g.current;t&&(t.currentTime=Math.max(0,(t.currentTime||0)-10))},children:"◀ 10s"}),e.jsx("button",{onClick:()=>{const t=g.current;t?t.pause():t&&t.play().catch(()=>{})},children:"Play/Pause"}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsx("button",{onClick:T,children:"Mark as Complete"})})]})]}),e.jsxs("aside",{style:z,children:[e.jsx("h4",{style:{marginTop:0},children:"Lessons"}),e.jsx("ul",{style:{padding:0,margin:0,listStyle:"none",display:"flex",flexDirection:"column",gap:8},children:x.map((t,s)=>e.jsx("li",{children:e.jsx("button",{onClick:()=>f(s),style:{width:"100%",textAlign:"left",padding:"10px",borderRadius:6,background:s===n?"#f3f4f6":"transparent",border:"none",cursor:"pointer"},children:e.jsx("div",{style:{fontWeight:600},children:t.title})})},t.id))})]})]})}),l.current)}var U={};const Q=()=>{const[p,m]=i.useState("popular"),[x,I]=i.useState([]),[y,j]=i.useState(null),l=U.REACT_APP_API_URL;i.useEffect(()=>{fetch(`${l}/courses`,{method:"POST",headers:{"Content-Type":"application/json","x-access-token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMjM0LCJ1c2VyX3R5cGVfaWQiOjAsInJvbGUiOiJndWVzdCIsImlhdCI6MTc1ODg4NDcwOCwiZXhwIjoxNzY0MDY4NzA4fQ.zWg19kpqcRf0sxKzrioWP_HzogoC5fHQPeGHTE6nZpc"},body:JSON.stringify({user_id:"68d27fa20a1b391f84d652ba",source:"Livguard"})}).then(n=>n.json()).then(n=>{n.data?I(n.data):console.error("Error:",n.error)}).catch(n=>console.error(n))},[]);const g=(n,f)=>{j({courseId:n._id,lessons:n.videos.map(r=>({id:r._id.toString(),title:r.name,src:r.url})),startLessonId:f._id.toString()})},b=(n,f)=>{const r=[];for(let a=0;a<n.length;a+=f)r.push(n.slice(a,a+f));return r};return e.jsx("section",{className:"course-posts section light-background",children:e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"section-title","data-aos":"fade-up",children:[e.jsx("h5",{children:"Popular Courses"}),e.jsx("p",{children:"We offer a variety of courses to suit your learning needs. Explore our options and find the perfect fit for you."})]}),e.jsxs("div",{className:"text-center mb-5 tabs",children:[e.jsx("button",{className:`btn theme-btn mx-2 ${p==="popular"?"active":""}`,onClick:()=>m("popular"),children:"For Students"}),e.jsx("button",{className:`btn theme-btn mx-2 ${p==="recommended"?"active":""}`,onClick:()=>m("recommended"),children:"For Teachers"})]}),p==="popular"&&e.jsx(e.Fragment,{children:b(x,3).map((n,f)=>e.jsx("div",{className:"row gy-4 featured",children:n.map(r=>e.jsx("div",{className:"col-lg-4",children:e.jsxs("article",{children:[e.jsx("div",{className:"post-img",children:e.jsx("div",{children:e.jsx("img",{alt:"",className:"img-fluid",src:r.courseImage??"/static/media/blog-1.97a1a61032fc6b5b3c4c.jpg"})})}),e.jsx("p",{className:"post-category",children:"Study Tips"}),e.jsxs("h3",{className:"title mb-2",children:[r.courseName," - ",e.jsx("sup",{children:"₹"}),"19",e.jsx("span",{children:"/month"})]}),e.jsx("a",{href:"#",className:"buy-btn",children:"Enroll Now"}),e.jsx("ul",{children:r.videos.map(a=>e.jsxs("li",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-play-circle"})," ",a.name]}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>g(r,a),children:"▶ Play"})]},a._id))})]})},r._id))},f))}),p==="recommended"&&e.jsx(e.Fragment,{children:b(x,3).map((n,f)=>e.jsx("div",{className:"row gy-4 featured",children:n.map(r=>e.jsx("div",{className:"col-lg-4",children:e.jsxs("article",{children:[e.jsx("div",{className:"post-img",children:e.jsx("div",{children:e.jsx("img",{alt:"",className:"img-fluid",src:r.courseImage??"/static/media/blog-1.97a1a61032fc6b5b3c4c.jpg"})})}),e.jsx("p",{className:"post-category",children:"Study Tips"}),e.jsxs("h3",{className:"title mb-2",children:[r.courseName," - ",e.jsx("sup",{children:"₹"}),"19",e.jsx("span",{children:"/month"})]}),e.jsx("a",{href:"#",className:"buy-btn",children:"Enroll Now"}),e.jsx("ul",{children:r.videos.map(a=>e.jsxs("li",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-play-circle"})," ",a.name]}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>g(r,a),children:"▶ Play"})]},a._id))})]})},r._id))},f))}),y&&e.jsx(D,{userId:"68d27fa20a1b391f84d652ba",courseId:y.courseId.toString(),lessons:y.lessons,startLessonId:y.startLessonId,isOpen:!0,onClose:()=>j(null)})]})})};export{Q as A};
